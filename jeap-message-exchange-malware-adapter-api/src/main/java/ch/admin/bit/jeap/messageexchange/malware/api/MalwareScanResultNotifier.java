package ch.admin.bit.jeap.messageexchange.malware.api;

import lombok.extern.slf4j.Slf4j;

import java.util.ArrayList;
import java.util.List;

/**
 * Abstract class which should be extended in a concrete plugin/submodule
 */
@Slf4j
public abstract class MalwareScanResultNotifier {

    private final List<MalwareScanResultListener> listeners = new ArrayList<>();

    /**
     * Subscribe a listener to receive malware scan results.
     *
     * @param malwareScanResultListener the listener to subscribe
     */
    public void subscribe(MalwareScanResultListener malwareScanResultListener) {
        listeners.add(malwareScanResultListener);
    }

    /**
     * Notify all subscribed listeners about the malware scan result.
     * Convenient method to be called by subclasses.
     *
     * @param key        the object key
     * @param bucketName the bucket name
     * @param scanResult the malware scan result
     */
    protected final void notifyListeners(String key, String bucketName, MalwareScanResult scanResult) {
        for (MalwareScanResultListener listener : listeners) {
            try {
                listener.onMalwareScanResult(key, bucketName, scanResult);
            } catch (Exception e) {
                log.error("Could not notify listener " + listener, e);
            }
        }
    }

}
