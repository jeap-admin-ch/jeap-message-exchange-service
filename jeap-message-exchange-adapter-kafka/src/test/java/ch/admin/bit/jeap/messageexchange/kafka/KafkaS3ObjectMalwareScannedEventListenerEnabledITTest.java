package ch.admin.bit.jeap.messageexchange.kafka;

import ch.admin.bit.jeap.messageexchange.domain.database.MessageRepository;
import ch.admin.bit.jeap.messageexchange.domain.metrics.MetricsService;
import ch.admin.bit.jeap.messageexchange.domain.objectstore.ObjectStore;
import ch.admin.bit.jeap.messaging.kafka.test.KafkaIntegrationTestBase;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.junit.jupiter.MockitoExtension;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.context.SpringBootTest;
import org.springframework.context.ApplicationContext;
import org.springframework.test.context.bean.override.mockito.MockitoBean;

import static org.junit.jupiter.api.Assertions.assertTrue;

@SpringBootTest(
        properties = {
                "jeap.messageexchange.kafka.topic.message-received=message-received",
                "jeap.messaging.kafka.error-topic-name=error",
                "jeap.messaging.kafka.system-name=my-system-name",
                "jeap.messaging.kafka.service-name=my-service-name",
                "spring.application.name=junit",
                "jeap.messageexchange.malwarescan.enabled=true",
                "jeap.messageexchange.kafka.topic.malware-scan-result=malware-scan"
        },
        classes = TestApp.class)
@ExtendWith(MockitoExtension.class)
class KafkaS3ObjectMalwareScannedEventListenerEnabledITTest extends KafkaIntegrationTestBase {

    @MockitoBean
    @SuppressWarnings("unused")
    private ObjectStore objectStore;

    @MockitoBean
    @SuppressWarnings("unused")
    private MessageRepository messageRepository;

    @MockitoBean
    @SuppressWarnings("unused")
    private MetricsService metricsService;

    @Autowired
    private ApplicationContext applicationContext;

    @Test
    void listenertartedWhenMalwareScanEnabled() {
        assertTrue(applicationContext.containsBean("kafkaS3ObjectMalwareScannedEventListener"));
    }

}
